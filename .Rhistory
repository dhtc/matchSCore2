load(file="~/Dropbox/HCA_benchmarking_sample/10X/reference_mod/gene_cl.ref3.RData")
exp.markers <- sapply(gene_cl.ref,function(x) Matrix::colMeans(data@data[x,]))
exp.markers <- sapply(gene_cl.ref,function(x) Matrix::colMeans(data@data[which(rownames(data@data) %in% x),]))
#exp.markers <- t(apply(exp.markers,1, function(x) (x-min(x))/(max(x)-min(x))))
dim(exp.markers)
exp.markers <- data.frame(exp.markers)
colnames(exp.markers)
ct <- c("B.cells","CD14..Monocytes","HEK.cells")
exp.markers <- exp.markers[,ct]
head(exp.markers)
cell_types
cells <- rownames(data@meta.data)[which(nnet %in% cell_types)]
cells.p <-which(nnet %in% cell_types)
df <- data.frame(exp.markers[cells,],id=factor(data@meta.data$nnet2[cells.p]),batch=factor(data@meta.data$batch[cells.p]))
head(df)
table(df$id)
table(df$batch)
df$cell <- rownames(df)
df.x <-lapply(levels(df$id),function(x) df[which(df$id==x),])
names(df.x) <- levels(df$id)
load(file="col.batch.RData")
gg1 <- ggplot(df.x$`B cells`,aes(x=cell,y=B.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("B cells")+ylab("B cells signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
library(ggpubr)
png(file="barplot_markers_signatures_by_technology.png",width = 8, height = 6, units = 'in', res = 600)
ggarrange(gg1,gg2,gg3,ncol = 3,nrow = 1,common.legend = T)
dev.off()
png(file="barplot_markers_signatures_by_technology.png",width = 9, height = 6, units = 'in', res = 600)
ggarrange(gg1,gg2,gg3,ncol = 3,nrow = 1,common.legend = T)
dev.off()
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(c(0,max(df.x$`CD14+ Monocytes`)))
gg2
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(c(0,2))
gg2
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(c(0:2))
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(0,2)
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(0,2)
gg2
?xlim
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(0,2)
gg2
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")
gg2
col.batch
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(0,10)
gg2
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")+xlim(0:2)
levels(df$batch)
levels(df$batch)[5] <- "Chromium(sn)"
levels(df$batch)[12] <- "mcSCRB-Seq"
df.x <-lapply(levels(df$id),function(x) df[which(df$id==x),])
names(df.x) <- levels(df$id)
load(file="col.batch.RData")
gg1 <- ggplot(df.x$`B cells`,aes(x=cell,y=B.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("B cells")+ylab("B cells signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
library(ggpubr)
ggarrange(gg1,gg3,ncol = 2,nrow = 1,common.legend = T)
png(file="barplot_markers_signatures_by_technology.png",width = 9, height = 6, units = 'in', res = 600)
ggarrange(gg1,gg3,ncol = 2,nrow = 1,common.legend = T)
dev.off()
df.x <-lapply(levels(df$id),function(x) df[which(df$id==x),])
names(df.x) <- levels(df$id)
gg1 <- ggplot(df.x$`B cells`,aes(x=cell,y=B.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("B cells")+ylab("B cells signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
ggarrange(gg1,gg3,ncol = 2,nrow = 1,common.legend = T)
png(file="barplot_markers_signatures_by_technology.png",width = 9, height = 6, units = 'in', res = 600)
ggarrange(gg1,gg3,ncol = 2,nrow = 1,common.legend = T)
dev.off()
levels(df$batch)
levels(df.x$batch)
unique(df.x$batch)
table(df.x$batch)
head(df.x)
head(df.x$`HEK cells`)
head(df.x$`HEK cells`$batch)
levels(df.x$`HEK cells`$batch)
table(col.batch)
col.batch
tech <- unique(data@meta.data$batch)
tech
levels(data@meta.data$batch)
levels(factor(data@meta.data$batch))
levels(factor(data@meta.data$batch))[10]
levels(factor(data@meta.data$batch))[5]
levels(factor(data@meta.data$batch))[5] <- "Chromium(sn)"
levels(factor(data@meta.data$batch))[5] <- "Chromium(sn)"
data@meta.data$batch <- as.factor(data@meta.data$batch)
levels(data@meta.data$batch)[5]
levels(data@meta.data$batch)[5] <- "Chromium(sn)"
levels(data@meta.data$batch)[12]
levels(data@meta.data$batch)[12] <- "mcSCRB-Seq"
load(file="out_Seurat/data_seu.obj_res0.6_dim14_withHVG.RData")
tech <- unique(data@meta.data$batch)
data@meta.data$batch <- as.factor(data@meta.data$batch)
levels(data@meta.data$batch)[5] <- "Chromium(sn)"
levels(data@meta.data$batch)[12] <- "mcSCRB-Seq"
nnet <- factor(data@meta.data$nnet2)
cell_types <- levels(nnet)[c(1:2,7)]
load(file="~/Dropbox/HCA_benchmarking_sample/10X/reference_mod/gene_cl.ref3.RData")
exp.markers <- sapply(gene_cl.ref,function(x) Matrix::colMeans(data@data[which(rownames(data@data) %in% x),]))
#exp.markers <- t(apply(exp.markers,1, function(x) (x-min(x))/(max(x)-min(x))))
dim(exp.markers)
exp.markers <- data.frame(exp.markers)
colnames(exp.markers)
colnames(exp.markers)
ct <- c("B.cells","CD14..Monocytes","HEK.cells")
exp.markers <- exp.markers[,ct]
head(exp.markers)
cells <- rownames(data@meta.data)[which(nnet %in% cell_types)]
cells.p <-which(nnet %in% cell_types)
df <- data.frame(exp.markers[cells,],id=factor(data@meta.data$nnet2[cells.p]),batch=factor(data@meta.data$batch[cells.p]))
head(df)
table(df$id)
table(df$batch)
df$cell <- rownames(df)
levels(df$batch)[5]
df.x <-lapply(levels(df$id),function(x) df[which(df$id==x),])
names(df.x) <- levels(df$id)
load(file="col.batch.RData")
gg1 <- ggplot(df.x$`B cells`,aes(x=cell,y=B.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("B cells")+ylab("B cells signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+xlab("HEK293T cells")+ylab("HEK293 signature")
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature") +
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
gg2 <- ggplot(df.x$`CD14+ Monocytes`,aes(x=cell,y=CD14..Monocytes))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("CD14+ Monocytes")+ylab("CD14+ Monocytes signature")
gg3 <- ggplot(df.x$`HEK cells`,aes(x=cell,y=HEK.cells))+geom_bar(aes(fill=batch),stat = "identity",position = "dodge")+
scale_fill_manual(values=col.batch)+theme(axis.text.x = element_blank(),axis.text.y = element_text(size=16),
axis.title = element_text(size=16),axis.line = element_line(size=1))+
xlab("HEK293T cells")+ylab("HEK293 signature")
library(ggpubr)
png(file="barplot_markers_signatures_by_technology.png",width = 9, height = 6, units = 'in', res = 600)
ggarrange(gg1,gg3,ncol = 2,nrow = 1,common.legend = T)
dev.off()
load(file="out_Seurat/data_seu.obj_res0.6_dim14_withHVG.RData")
tech <- unique(data@meta.data$batch)
data@meta.data$batch <- as.factor(data@meta.data$batch)
levels(data@meta.data$batch)[5] <- "Chromium(sn)"
levels(data@meta.data$batch)[12] <- "mcSCRB-Seq"
nnet <- factor(data@meta.data$nnet2)
cell_types <- levels(nnet)[c(1:8)]
load(file="~/Dropbox/HCA_benchmarking_sample/10X/reference_mod/gene_cl.ref3.RData")
exp.markers <- sapply(gene_cl.ref,function(x) Matrix::colMeans(data@data[which(rownames(data@data) %in% x),]))
dim(exp.markers)
exp.markers <- data.frame(exp.markers)
colnames(exp.markers)
exp.markers <- exp.markers[,c(1,2,7)]
cells <- rownames(data@meta.data)[which(nnet %in% cell_types)]
cells.p <-which(nnet %in% cell_types)
df <- data.frame(exp.markers[cells,],id=factor(data@meta.data$nnet2[cells.p]),batch=factor(data@meta.data$batch[cells.p]))
head(df)
table(df$id)
table(df$batch)
df$cell <- rownames(df)
head(df)
df.x <-lapply(levels(df$id),function(x) df[which(df$id==x),])
names(df.x) <- levels(df$id)
head(df.x$`B cell`)
load(file="col.batch.RData")
levels(batch)
sapply(names(col.batch),function(x) )
names(col.batch)
levels(df.x$`B cell`$batch)
table(df.x$`B cell`)
table(df.x$`B cell`$id)
sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x,]))
sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x]))
sort(sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x])))
ave.exp.markers <- sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x]))
ave <- sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x]))
ave.exp.markers <- sapply(ave.exp.markers,function(x) x-min(ave)/(max(ave)-min(ave)))
ave.exp.markers
ave.exp.markers <- sapply(ave,function(x) x-min(ave)/(max(ave)-min(ave)))
ave.exp.markers
ave.exp.markers <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
ave.exp.markers
ave <- sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x]))
aveB <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
ave <- sapply(levels(df.x$`CD14+ Monocyte`$batch),function(x) mean(df.x$`CD14+ Monocyte`$CD14..Monocytes[df.x$`CD14+ Monocyte`$batch==x]))
ave.Mono <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
ave.Mono
aveB
ave <- sapply(levels(df.x$`HEK293T cell`$batch),function(x) mean(df.x$`HEK293T cell`$HEK.cells[df.x$`HEK293T cell`$batch==x]))
ave.hek <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
aveB
sort(aveB)
ave.Mono <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(ave.Mono)
sort(ave.hek)
ave <- sapply(levels(df.x$`HEK293T cell`$batch),function(x) mean(df.x$`HEK293T cell`$HEK.cells[df.x$`HEK293T cell`$batch==x]))
ave.hek <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(ave.hek)
ave <- sapply(levels(df.x$`CD14+ Monocyte`$batch),function(x) mean(df.x$`CD14+ Monocyte`$CD14..Monocytes[df.x$`CD14+ Monocyte`$batch==x]))
ave.Mono <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(ave.Mono)
ave <- sapply(levels(df.x$`B cell`$batch),function(x) mean(df.x$`B cell`$B.cells[df.x$`B cell`$batch==x]))
aveB <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(aveB)
ave <- sapply(levels(df.x$`CD14+ Monocyte`$batch),function(x) mean(df.x$`CD14+ Monocyte`$CD14..Monocytes[df.x$`CD14+ Monocyte`$batch==x]))
ave.Mono <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(ave.Mono)
ave <- sapply(levels(df.x$`HEK293T cell`$batch),function(x) mean(df.x$`HEK293T cell`$HEK.cells[df.x$`HEK293T cell`$batch==x]))
ave.hek <- sapply(ave,function(x) (x-min(ave))/(max(ave)-min(ave)))
sort(ave.hek)
library(Seurat)
load(file="merged/sce.all.technologies.RData")
colData(sce)
setwd("~/Dropbox/HCA_benchmarking_sample/Downsampled_analysis/Human/DS_20K/")
setwd("~/Dropbox/HCA_benchmarking_sample/Downsampled_analysis/Human/DS_20K/")
load(file="merged/sce_merged.RData")
batch <- as.factor(sce@colData$batch)
levels(batch)
levels(batch)
levels(batch)[4] <- "Chromium V2"
levels(batch)[12] <- "mcSCRB-Seq"
levels(batch)[5] <- "Chromium(sn)"
nnet <- as.factor(sce@colData$nnet2)
names(nnet) <- colnames(sce)
names(batch) <- colnames(sce)
id <- factor(nnet[grep("Monocytes|HEK|B",nnet)])
levels(id) <- c("B","Monocytes","Monocytes","HEK")
length(id)
cells <- names(id)
length(cells)
raw <- as.matrix(counts(sce))[,cells]
batch <- factor(batch[cells])
t <- table(id,batch)
t
sizes <- apply(t,1,function(x) min(x))
sub.tech <- sapply(levels(batch),function(x) cells[which(batch==x)])
sub.id <- sapply(levels(id),function(x) sapply(sub.tech,function(y) sample(x=y[which(id[y]==x)],size = sizes[which(names(sizes)==x)])))
merge <- lapply(sub.id,function(x) apply(x,2,function(y) rowSums(raw[,y])))
corr <- lapply(merge,function(x) cor(x,use="pairwise.complete.obs",method="pearson"))
load(file="~/Dropbox/HCA_benchmarking_sample/10X/reference_mod/gene_cl.ref3.RData")
markers <- gene_cl.ref[c("B cells","CD14+ Monocytes","HEK cells")]
names(markers) <- c("B","Monocytes","HEK")
merge.markers <- lapply(names(markers),function(x) apply(sub.id[[x]],2,function(y) rowSums(raw[which(markers[[x]] %in% rownames(raw)),y])))
corr.markers <- lapply(merge.markers,function(x) cor(x,use="pairwise.complete.obs",method="pearson"))
names(corr.markers) <- names(markers)
col <- colorRampPalette(c(rep("white",3),"#FFECB3","#E85285","#6A1B9A"))
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
library(corrplot)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
png(file="correlation/corplot_allgenes_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
png(file="correlation/corplot_allgenes_Monocytes.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_allgenes_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
load(file="corr.markers.genes.RData")
load(file="corr.all.genes.RData")
png(file="correlation/corplot_allgenes_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_allgenes_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
head(corr$B)
names(corr$B)
colnames(corr$B)
colnames(corr$B)[4]
colnames(corr$B)[4] <- "Chromium V2"
colnames(corr$B)[4] <- "Chromium V2"
rownames(corr$B)[4] < "Chromium V2"
png(file="correlation/corplot_allgenes_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
colnames(corr$Monocytes)[4]
colnames(corr$Monocytes)[4] <- "Chromium V2"
rownames(corr$Monocytes)[4] < "Chromium V2"
colnames(corr$HEK)[4] <- "Chromium V2"
rownames(corr$HEK)[4] < "Chromium V2"
colnames(corr.markers$B)[4] <- "Chromium V2"
rownames(corr.markers$B)[4] < "Chromium V2"
colnames(corr.markers$Monocytes)[4] <- "Chromium V2"
rownames(corr.markers$Monocytes)[4] < "Chromium V2"
colnames(corr.markers$HEK)[4] <- "Chromium V2"
rownames(corr.markers$HEK)[4] < "Chromium V2"
colnames(corr.markers$B)[4] <- "Chromium V2"
rownames(corr.markers$B)[4] < "Chromium V2"
colnames(corr.markers$Monocytes)[4] <- "Chromium V2"
rownames(corr.markers$Monocytes)[4] < "Chromium V2"
colnames(corr.markers$HEK)[4] <- "Chromium V2"
rownames(corr.markers$HEK)[4] < "Chromium V2"
png(file="correlation/corplot_allgenes_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_allgenes_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
rownames(corr.markers$HEK)
colnames(corr$B)[4] <- "Chromium V2"
rownames(corr$B)[4] <- "Chromium V2"
colnames(corr$Monocytes)[4] <- "Chromium V2"
rownames(corr$Monocytes)[4] <- "Chromium V2"
colnames(corr$HEK)[4] <- "Chromium V2"
rownames(corr$HEK)[4] <- "Chromium V2"
colnames(corr.markers$B)[4] <- "Chromium V2"
rownames(corr.markers$B)[4] <- "Chromium V2"
colnames(corr.markers$Monocytes)[4] <- "Chromium V2"
rownames(corr.markers$Monocytes)[4] <- "Chromium V2"
colnames(corr.markers$HEK)[4] <- "Chromium V2"
rownames(corr.markers$HEK)[4] <- "Chromium V2"
png(file="correlation/corplot_allgenes_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_allgenes_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_B.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$B, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_Monocytes.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$Monocytes, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr.markers$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_markers_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
png(file="correlation/corplot_allgenes_HEK.2.png",width = 9, height = 9, units = 'in', res = 600)
corrplot(corr$HEK, method = "square",order = "hclust",hclust.method = "ward.D2",type="upper",col = col(100),tl.col="black",tl.cex=2,number.cex = 20)
dev.off()
load(file="~/Dropbox/HCA_ELI/Eli_analysis/Human/Seurat_object_DS20K/ChromiumNuclei_clustering_DS20K_dim1to8_res06_OBJ.RData")
ChromiumNuclei.DS.obj@var.genes
length(ChromiumNuclei.DS.obj@var.genes)
nuclei_hvg <- ChromiumNuclei.DS.obj@var.genes
save(hvg,file="hvg.RData")
save(hvg,file="hvg.RData")
nuclei_hvg <- ChromiumNuclei.DS.obj@var.genes
hvg <- ChromiumNuclei.DS.obj@var.genes
save(hvg,file="~/Dropbox/HCA_benchmarking_sample/hvg_nuclei_DS20.RData")
load(file = "~/Dropbox/Ati_HCA_test/PBMC_10X/out_Seurat/ramon/data_seu.obj_res0.6_annotated.RData")
load(file="~/Dropbox/Ati_HCA_test/PBMC_10X/out_Seurat/ramon/pbmc_gene_cl.RData")
library(ggplot2)
library(Seurat)
pbmc <- data
rm(data)
pbmc <- UpdateSeuratObject(pbmc)
load(file="../reference_mod/reference3_last_version.RData")
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
library(matchSCore2)
setwd("~/Dropbox (Personal)/matchSCore.v2_pkg/matchSCore2")
document()
library(devtools)
library(roxygen2)
document()
devtools::check(document = FALSE)
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
library(matchSCore2)
?matchSCore2
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
library(matchSCore2)
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
library(matchSCore2)
library("devtools")
install_github('elimereu/matchSCore2')
library(matchSCore2)
?matchSCore2
?correlation_run
?matchSCore2
remove.packages("matchSCore2",lib = "/Library/Frameworks/R.framework/Versions/3.5/Resources/library/")
library(matchSCore2)
library(devtools)
library(roxygen2)
setwd("~/Dropbox/matchSCore.v2_pkg/matchSCore2")
document()
devtools::check(document = FALSE)
git fetch --all
library(scater)
library(scater)
#sce <- runDiffusionMap(sce,feature_set)
?runDiffusionMap
